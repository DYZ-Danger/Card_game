# é¡¹ç›®æ¶æ„æ€»ç»“

## ğŸ¯ é¡¹ç›®ç›®æ ‡

å®ç°ä¸€ä¸ªåŸºäº cocos2d-x 3.17 çš„å¡ç‰Œå°æ¸¸æˆæ¡†æ¶ï¼Œæ”¯æŒï¼š
- ä¸»ç‰ŒåŒºä¸å †ç‰ŒåŒºçš„å¡ç‰ŒåŒ¹é…æ¶ˆé™¤
- å¡ç‰ŒåŠ¨ç”»å’Œäº¤äº’
- å®Œæ•´çš„æ’¤é”€åŠŸèƒ½
- å¯æ‰©å±•çš„æ¶æ„è®¾è®¡

---

## ğŸ“ æ¶æ„è®¾è®¡

### MVC æ¨¡å¼ + åˆ†å±‚æ¶æ„

```
User Interaction
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Views (UI Layer)             â”‚
â”‚  - CardView, GameView                â”‚
â”‚  - å¤„ç†æ˜¾ç¤ºå’Œç”¨æˆ·è¾“å…¥                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ Events â†‘ Display
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Controllers (Logic Layer)        â”‚
â”‚  - GameController                     â”‚
â”‚  - å¤„ç†ä¸šåŠ¡è§„åˆ™å’Œæµç¨‹æ§åˆ¶              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ Data Updates â†‘ Query
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Models (Data Layer)                  â”‚
â”‚  - Card, GameModel, UndoModel        â”‚
â”‚  - å­˜å‚¨æ¸¸æˆçŠ¶æ€å’Œæ•°æ®                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®Œæ•´çš„ä¸ƒå±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Configs (é…ç½®å±‚)                         â”‚
â”‚    - CardEnums, GameConfig, LevelConfig     â”‚
â”‚    - çº¯æ•°æ®å®šä¹‰ï¼Œæ— é€»è¾‘                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Models (æ•°æ®æ¨¡å‹å±‚)                      â”‚
â”‚    - Card, GameModel, UndoModel             â”‚
â”‚    - å­˜å‚¨è¿è¡Œæ—¶æ•°æ®ï¼Œæ— ä¸šåŠ¡é€»è¾‘             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Views  â”‚ â”‚ 4. Controllers              â”‚
â”‚ (è§†å›¾å±‚)   â”‚ â”‚ (æ§åˆ¶å™¨å±‚)                  â”‚
â”‚ - CardViewâ”‚ â”‚ - GameController            â”‚
â”‚ - GameViewâ”‚ â”‚ - åè°ƒ Model & View         â”‚
â”‚ - ä»…æ˜¾ç¤º  â”‚ â”‚ - å¤„ç†ä¸šåŠ¡é€»è¾‘              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†‘              â†“
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Managers (ç®¡ç†å™¨å±‚)                      â”‚
â”‚    - UndoManager                            â”‚
â”‚    - Controller çš„æˆå‘˜ï¼Œç®¡ç†ç‰¹å®šåŠŸèƒ½       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Services (æœåŠ¡å±‚)                        â”‚
â”‚    - GameModelGenerator, ScoreCalculator    â”‚
â”‚    - æ— çŠ¶æ€æœåŠ¡ï¼Œå¤ç”¨æ€§å¼º                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Utils (å·¥å…·å±‚)                           â”‚
â”‚    - LevelConfigLoader                      â”‚
â”‚    - é€šç”¨è¾…åŠ©å·¥å…·                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 1ï¸âƒ£ æ•°æ®æµå‘

```
å…³å¡é…ç½® JSON
     â†“
LevelConfigLoader (åŠ è½½)
     â†“
LevelConfig (é…ç½®å¯¹è±¡)
     â†“
GameModelGenerator (ç”Ÿæˆ)
     â†“
GameModel (è¿è¡Œæ—¶æ•°æ®)
     â”œâ”€ PlayfieldCards[]
     â”œâ”€ StackCards[]
     â””â”€ GameState
```

### 2ï¸âƒ£ äº¤äº’æµå‘

```
ç”¨æˆ·ç‚¹å‡» UI
     â†“
TouchEvent (ç³»ç»Ÿäº‹ä»¶)
     â†“
CardView (æ„Ÿåº”è§¦æ‘¸)
     â†“
Callback â†’ GameController.handleCardClick(cardId)
     â†“
1. æ£€æŸ¥åŒ¹é…è§„åˆ™ (Model æ•°æ®)
2. è®°å½•æ’¤é”€ä¿¡æ¯ (UndoManager)
3. æ›´æ–° Model çŠ¶æ€
4. è°ƒç”¨ View åŠ¨ç”» (CardView.playMoveAnimation)
     â†“
è§†è§‰åé¦ˆ (åŠ¨ç”»å®Œæˆ)
```

### 3ï¸âƒ£ æ’¤é”€æµå‘

```
ç”¨æˆ·ç‚¹å‡»æ’¤é”€
     â†“
GameView æ’¤é”€æŒ‰é’®å›è°ƒ
     â†“
GameController.handleUndo()
     â†“
UndoManager.executeUndo()
     â”œâ”€ ä» UndoModel å¼¹å‡ºè®°å½•
     â”œâ”€ åº”ç”¨æ’¤é”€é€»è¾‘
     â””â”€ è§¦å‘å®Œæˆå›è°ƒ
     â†“
Controller å¤„ç†åå‘åŠ¨ç”»
     â†“
CardView åå‘ç§»åŠ¨
     â†“
æ¸¸æˆæ¢å¤åˆ°ä¸Šä¸€æ­¥
```

---

## ğŸ”„ å…³é”®å·¥ä½œæµç¨‹è¯¦è§£

### åˆå§‹åŒ–æµç¨‹

```
GameScene::initWithLevelId(1)
  â”œâ”€ LevelConfigLoader::loadLevelConfig(1)
  â”‚  â””â”€ è¯»å– Resources/levels/level_1.json
  â”‚     è¿”å› LevelConfig å¯¹è±¡
  â”‚
  â”œâ”€ GameController::create()
  â”‚  â””â”€ GameController::initWithLevelConfig(config)
  â”‚     â”œâ”€ GameModelGenerator::generateGameModel()
  â”‚     â”‚  â”œâ”€ åˆ›å»º GameModel
  â”‚     â”‚  â”œâ”€ éå†é…ç½®åˆ›å»º Card å¯¹è±¡
  â”‚     â”‚  â””â”€ æ·»åŠ åˆ° GameModel
  â”‚     â”‚
  â”‚     â”œâ”€ GameView::create(gameModel)
  â”‚     â”‚  â”œâ”€ åˆ›å»ºä¸»ç‰ŒåŒºå¸ƒå±€
  â”‚     â”‚  â”œâ”€ åˆ›å»ºå †ç‰ŒåŒºå¸ƒå±€
  â”‚     â”‚  â””â”€ åˆ›å»ºæ’¤é”€æŒ‰é’®
  â”‚     â”‚
  â”‚     â”œâ”€ ä¸ºæ¯å¼  Card åˆ›å»º CardView
  â”‚     â”‚  â””â”€ æ·»åŠ åˆ°ç›¸åº”çš„çˆ¶èŠ‚ç‚¹
  â”‚     â”‚
  â”‚     â”œâ”€ UndoManager::create()
  â”‚     â”‚  â””â”€ åˆå§‹åŒ–æ’¤é”€ç³»ç»Ÿ
  â”‚     â”‚
  â”‚     â””â”€ ç»‘å®šæ‰€æœ‰å›è°ƒå‡½æ•°
  â”‚
  â”œâ”€ æ·»åŠ  GameView åˆ°åœºæ™¯
  â”‚
  â””â”€ GameController::startGame()
     â””â”€ è®¾ç½®æ¸¸æˆçŠ¶æ€ä¸º PLAYING
```

### å¡ç‰ŒåŒ¹é…æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»ä¸»ç‰ŒåŒºçš„å¡ç‰Œ â™¦3
  â†“
GameView::_onTouchBegan()
  â”œâ”€ æ£€æµ‹è§¦æ‘¸ä½ç½®
  â”œâ”€ éå† _cardViews æ‰¾åˆ°å¯¹åº”çš„ CardView
  â””â”€ è°ƒç”¨ _onCardClickCallback(cardId)
  â†“
GameController::handleCardClick(3)
  â”œâ”€ è·å–ç‚¹å‡»çš„å¡ç‰Œ: Card* clickedCard
  â”œâ”€ è·å–å †é¡¶å¡ç‰Œ: Card* topCard
  â”‚
  â”œâ”€ æ£€æŸ¥åŒ¹é…æ¡ä»¶:
  â”‚  â”œâ”€ clickedCard->canMatch(topCard)
  â”‚  â”‚  â””â”€ æ£€æŸ¥ç‚¹æ•°å·®æ˜¯å¦ä¸º 1
  â”‚  â”‚     ç‚¹æ•° 3 ä¸ 4 ç›¸å·® 1 âœ“
  â”‚  â””â”€ å¦‚æœä¸åŒ¹é…åˆ™è¿”å› false
  â”‚
  â”œâ”€ è®°å½•æ’¤é”€:
  â”‚  â”œâ”€ åˆ›å»º UndoRecord
  â”‚  â”œâ”€ è®¾ç½®æºä½ç½®ã€ç›®æ ‡ä½ç½®ç­‰ä¿¡æ¯
  â”‚  â””â”€ _undoManager->recordUndo(record)
  â”‚     â””â”€ å­˜å…¥ UndoModel::_records æ ˆ
  â”‚
  â”œâ”€ æ›´æ–°æ¨¡å‹:
  â”‚  â”œâ”€ _gameModel->removePlayfieldCard(clickedCard)
  â”‚  â””â”€ _gameModel->removeStackCard(topCard)
  â”‚
  â”œâ”€ æ‰§è¡Œè§†å›¾åŠ¨ç”»:
  â”‚  â”œâ”€ è·å–å¡ç‰Œè§†å›¾
  â”‚  â”œâ”€ clickedCardView->playMoveAnimation(topCardPos)
  â”‚  â”‚  â””â”€ åˆ›å»º MoveTo åŠ¨ç”»
  â”‚  â”‚  â””â”€ è®¾ç½®å®Œæˆå›è°ƒï¼ˆä»è§†å›¾ä¸­ç§»é™¤å¡ç‰Œï¼‰
  â”‚  â””â”€ åŒæ—¶æ›´æ–°æ¨¡å‹æ•°æ®
  â”‚
  â””â”€ è¿”å› true è¡¨ç¤ºæˆåŠŸåŒ¹é…
  â†“
å¡ç‰Œæ’­æ”¾ç§»åŠ¨åŠ¨ç”»ä»åŸä½ç½®åˆ°å †é¡¶
  â†“
åŠ¨ç”»å®Œæˆï¼Œå¡ç‰Œä»æ¸¸æˆä¸­æ¶ˆé™¤
```

### æ’¤é”€æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»æ’¤é”€æŒ‰é’®
  â†“
GameView çš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶
  â”œâ”€ è°ƒç”¨æ³¨å†Œçš„å›è°ƒå‡½æ•°
  â””â”€ _onUndoClickCallback()
  â†“
GameController::handleUndo()
  â”œâ”€ æ£€æŸ¥ _undoManager æ˜¯å¦å¯æ’¤é”€
  â””â”€ _undoManager->executeUndo()
  â†“
UndoManager::executeUndo()
  â”œâ”€ æ£€æŸ¥ _undoModel->hasRecord()
  â”œâ”€ UndoRecord record = _undoModel->popLastRecord()
  â”‚  â””â”€ ä»è®°å½•æ ˆä¸­å¼¹å‡ºæœ€åä¸€æ¡æ“ä½œ
  â”‚
  â”œâ”€ _applyUndoRecord(record)
  â”‚  â””â”€ æ ¹æ®æ“ä½œç±»å‹æ¢å¤çŠ¶æ€
  â”‚
  â””â”€ è§¦å‘å®Œæˆå›è°ƒ: _onUndoCompleteCallback(record)
  â†“
Controller çš„æ’¤é”€å®Œæˆå›è°ƒ
  â”œâ”€ è·å–è¦æ¢å¤çš„å¡ç‰Œè§†å›¾
  â”œâ”€ cardView->playMoveAnimation(sourcePosition)
  â”‚  â””â”€ å¡ç‰Œåå‘ç§»åŠ¨å›åŸä½ç½®
  â”‚
  â”œâ”€ æ¢å¤å¡ç‰Œå¯è§æ€§
  â”œâ”€ æ¢å¤æ¨¡å‹ä¸­çš„å¡ç‰Œæ•°æ®
  â”‚
  â””â”€ æ¸¸æˆçŠ¶æ€æ¢å¤
  â†“
å¡ç‰Œåå‘åŠ¨ç”»å®Œæˆï¼Œæ¸¸æˆæ¢å¤åˆ°ä¸Šä¸€æ­¥
```

---

## ğŸ—ï¸ å„å±‚èŒè´£å¯¹æ¯”

| å±‚çº§ | èŒè´£ | æŒæœ‰æ•°æ® | æŒæœ‰ä¾èµ– | ç¤ºä¾‹ |
|------|------|--------|--------|------|
| **Config** | å®šä¹‰å¸¸é‡å’Œæšä¸¾ | âœ— | âœ— | CardEnums |
| **Model** | å­˜å‚¨è¿è¡Œæ—¶æ•°æ® | âœ“ | âœ— | Card, GameModel |
| **View** | æ˜¾ç¤º UIï¼Œæ¥æ”¶è¾“å…¥ | âœ— | Model(const) | CardView, GameView |
| **Controller** | åè°ƒ Model & View | âœ— | Model, View, Manager | GameController |
| **Manager** | ç®¡ç†ç‰¹å®šåŠŸèƒ½ | âœ“ | Model | UndoManager |
| **Service** | æä¾›æ— çŠ¶æ€æœåŠ¡ | âœ— | âœ— | GameModelGenerator |
| **Util** | æä¾›è¾…åŠ©å·¥å…· | âœ— | âœ— | LevelConfigLoader |

---

## ğŸ’¾ æ•°æ®ç»“æ„å…³ç³»

```
LevelConfig (é™æ€é…ç½®)
  â”œâ”€ levelId: int
  â”œâ”€ playfield: CardConfig[]
  â”‚  â”œâ”€ cardFace: CardFaceType
  â”‚  â”œâ”€ cardSuit: CardSuitType
  â”‚  â””â”€ position: Vec2
  â””â”€ stack: CardConfig[]

    â†“ (é€šè¿‡ GameModelGenerator è½¬æ¢)

GameModel (è¿è¡Œæ—¶æ•°æ®)
  â”œâ”€ _gameState: GameStateType
  â”œâ”€ _playfieldCards: Card[]
  â”‚  â”œâ”€ cardId
  â”‚  â”œâ”€ face: CardFaceType
  â”‚  â”œâ”€ suit: CardSuitType
  â”‚  â”œâ”€ position: Vec2
  â”‚  â”œâ”€ isVisible: bool
  â”‚  â””â”€ stackIndex: int
  â””â”€ _stackCards: Card[]

    â†“ (é€šè¿‡ Views æ˜¾ç¤º)

CardView (UI è¡¨ç°)
  â”œâ”€ _cardModel: Card*
  â”œâ”€ _cardSprite: Sprite*
  â”œâ”€ position: Vec2 (åŒæ­¥)
  â””â”€ visible: bool (åŒæ­¥)

GameView (å®¹å™¨)
  â”œâ”€ _playfieldNode: Node
  â”‚  â””â”€ CardView[] (ä¸»ç‰ŒåŒºå¡ç‰Œ)
  â”œâ”€ _stackNode: Node
  â”‚  â””â”€ CardView[] (å †ç‰ŒåŒºå¡ç‰Œ)
  â””â”€ _cardViews: Map<int, CardView*>
```

---

## ğŸ”Œ å›è°ƒæ¥å£è®¾è®¡

### View â†’ Controller

```cpp
// å¡ç‰Œè¢«ç‚¹å‡»
std::function<void(int cardId)> _onCardClickCallback;
gameView->setOnCardClickCallback([this](int cardId) {
    this->handleCardClick(cardId);
});

// æ’¤é”€æŒ‰é’®è¢«ç‚¹å‡»
std::function<void()> _onUndoClickCallback;
gameView->setOnUndoClickCallback([this]() {
    this->handleUndo();
});
```

### Manager â†’ Controller

```cpp
// æ’¤é”€å®Œæˆ
std::function<void(const UndoRecord&)> _onUndoCompleteCallback;
_undoManager->setOnUndoCompleteCallback([this](const UndoRecord& record) {
    // æ›´æ–°è§†å›¾æ˜¾ç¤º
    CardView* cardView = _gameView->getCardViewById(record.sourceCardId);
    cardView->playMoveAnimation(record.sourcePosition, ...);
});
```

---

## ğŸ® æ¸¸æˆè§„åˆ™å®ç°

### åŒ¹é…è§„åˆ™

```cpp
// åœ¨ Card ä¸­å®ç°
bool Card::canMatch(Card* other) const {
    if (!other) return false;
    
    // ç‚¹æ•°å·®å¿…é¡»æ°å¥½ä¸º 1
    int diff = calculateFaceDifference(other);
    return diff == 1;  // ä¾‹å¦‚ 3 å’Œ 4 èƒ½åŒ¹é…ï¼Œ3 å’Œ 5 ä¸èƒ½
}
```

### åŒºåŸŸç®¡ç†

```cpp
// ä¸»ç‰ŒåŒºå’Œå †ç‰ŒåŒºåˆ†åˆ«ç®¡ç†
GameModel* gameModel = GameModel::create();

// æ·»åŠ å¡ç‰Œåˆ°ä¸åŒåŒºåŸŸ
gameModel->addPlayfieldCard(card1);  // è®¾ç½® card1 çš„åŒºåŸŸä¸º PLAYFIELD
gameModel->addStackCard(card2);      // è®¾ç½® card2 çš„åŒºåŸŸä¸º STACK

// è·å–ç‰¹å®šåŒºåŸŸçš„å¡ç‰Œ
auto playfieldCards = gameModel->getPlayfieldCards();
auto stackCards = gameModel->getStackCards();
auto topCard = gameModel->getTopStackCard();
```

---

## ğŸš€ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½çš„æ­¥éª¤

1. **åœ¨ Configs ä¸­å®šä¹‰** - æ·»åŠ å¿…è¦çš„æšä¸¾æˆ–å¸¸é‡
2. **åœ¨ Models ä¸­å®ç°æ•°æ®** - å¢åŠ æ•°æ®å­˜å‚¨
3. **åœ¨ Services ä¸­å¤„ç†é€»è¾‘** - æ•°æ®è½¬æ¢å’Œå¤„ç†
4. **åœ¨ Controllers ä¸­è°ƒç”¨** - æ•´åˆæµç¨‹
5. **åœ¨ Views ä¸­æ˜¾ç¤º** - UI åé¦ˆ
6. **åœ¨ Managers ä¸­ç®¡ç†** - å¦‚æœéœ€è¦ç®¡ç†çŠ¶æ€

### æ·»åŠ æ–°çš„æ’¤é”€ç±»å‹

```cpp
// 1. åœ¨ UndoModel.h å®šä¹‰æ–°ç±»å‹
enum class OperationType {
    CARD_MOVE = 0,
    CARD_FLIP = 1,
    CARD_DRAW = 2,      // â† æ–°ç±»å‹
};

// 2. åœ¨ GameController ä¸­è®°å½•
UndoRecord record;
record.operationType = UndoRecord::OperationType::CARD_DRAW;
_undoManager->recordUndo(record);

// 3. åœ¨ UndoManager ä¸­å¤„ç†
void UndoManager::_applyUndoRecord(const UndoRecord& record) {
    switch (record.operationType) {
        case OperationType::CARD_DRAW:
            // æ¢å¤æŠ½ç‰Œæ“ä½œ
            break;
    }
}
```

---

## ğŸ“Š ç±»ä¾èµ–å›¾

```
GameScene
  â””â”€ GameController (å”¯ä¸€)
      â”œâ”€ GameModel (æ‹¥æœ‰)
      â”œâ”€ GameView (æ‹¥æœ‰)
      â”‚  â”œâ”€ CardView[] (æŒæœ‰)
      â”‚  â””â”€ Model(const)
      â””â”€ UndoManager (æ‹¥æœ‰)
          â””â”€ UndoModel (æ‹¥æœ‰)

LevelConfigLoader (util)
  â””â”€ LevelConfig (å‚æ•°)

GameModelGenerator (service)
  â””â”€ LevelConfig (å‚æ•°)
     â””â”€ GameModel (è¿”å›)
```

---

## âœ¨ è®¾è®¡ç‰¹ç‚¹

### âœ… ä¼˜ç‚¹

1. **å…³æ³¨ç‚¹åˆ†ç¦»** - æ¯ä¸ªç±»èŒè´£æ˜ç¡®
2. **ä½è€¦åˆ** - é€šè¿‡æ¥å£å’Œå›è°ƒé€šä¿¡
3. **é«˜å†…èš** - ç›¸å…³åŠŸèƒ½èšé›†åœ¨ä¸€èµ·
4. **æ˜“äºæµ‹è¯•** - æ¯å±‚å¯ç‹¬ç«‹æµ‹è¯•
5. **æ˜“äºæ‰©å±•** - æ·»åŠ æ–°åŠŸèƒ½åªéœ€æ‰©å±•ç›¸åº”å±‚
6. **çµæ´»é…ç½®** - JSON é…ç½®æ–‡ä»¶æ”¯æŒçµæ´»çš„å…³å¡è®¾è®¡

### ğŸ”’ çº¦æŸå’Œè§„èŒƒ

1. **Models** - ä¸å«ä¸šåŠ¡é€»è¾‘ï¼Œåªå­˜å‚¨æ•°æ®
2. **Views** - åªè¯»å¼•ç”¨ Modelï¼Œä¸ä¿®æ”¹æ•°æ®
3. **Controllers** - åªèƒ½ä¿®æ”¹ Modelï¼Œç„¶åé€šçŸ¥ View
4. **Managers** - ä½œä¸º Controller çš„æˆå‘˜ï¼Œä¸èƒ½åå‘ä¾èµ–
5. **Services** - æ— çŠ¶æ€ï¼Œé€šè¿‡å‚æ•°ä¼ é€’æ•°æ®
6. **Utils** - å®Œå…¨ç‹¬ç«‹ï¼Œä¸æ¶‰åŠä¸šåŠ¡

---

## ğŸ“ æ€»ç»“

è¿™ä¸ªæ¡†æ¶æä¾›äº†ä¸€ä¸ª**æ¸…æ™°ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•**çš„å¡ç‰Œæ¸¸æˆåŸºç¡€æ¶æ„ï¼š

- âœ… å®Œæ•´çš„æ•°æ®æ¨¡å‹
- âœ… åŠŸèƒ½å®Œå–„çš„è§†å›¾ç³»ç»Ÿ
- âœ… çµæ´»çš„æ§åˆ¶å™¨è®¾è®¡
- âœ… ä¸“ä¸šçš„ç®¡ç†å’ŒæœåŠ¡å±‚
- âœ… è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹
- âœ… æ”¯æŒå¿«é€Ÿé›†æˆå’Œå®šåˆ¶

**ç«‹å³å¼€å§‹å¼€å‘ä½ çš„å¡ç‰Œæ¸¸æˆå§ï¼** ğŸ´
